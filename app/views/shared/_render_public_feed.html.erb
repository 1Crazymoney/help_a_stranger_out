<%= render "shared/card_listeners" %>
<%= render "shared/smile" %>
<%= render "shared/signed_in" %>

<script type="text/javascript">
  var allDeedsDiv = document.getElementById('all-deeds');

  document.addEventListener('DOMContentLoaded', function() {
    TemplateManager.loadPublicDeeds(populateCards);
    TemplateManager.loadUserDeeds(hideCopy);
  });

  function populateCards(deedsList) {
    renderDeed(deedsList);
    addCardListeners();
    addSmileListeners();
    handleSignInStatus();
    var removeDeedButtons = document.getElementsByClassName('remove-deed-button');
    hideByClass(removeDeedButtons);
    var donateButtons = document.getElementsByClassName('donate-button');
    hideByClass(donateButtons);
  }

  function hideCopy(deedsList) {
    var copyDeedButtons = document.getElementsByClassName('copy-deed-button');
    deedsList.forEach(function(deed) {
      var id = deed.id;
      var button = document.querySelector("div[data-deed='"+ id + "'").querySelector('.copy-deed-button');
      button.classList.add('hide');
    });
  }

  function renderDeed(deeds) {
    var card = HandlebarsTemplates['deed_card']({deeds: deeds});
    allDeedsDiv.innerHTML = allDeedsDiv.innerHTML + card;
  }
</script>
